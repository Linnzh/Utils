## 命令模式 - Command

概念：将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化，延迟请求执行或将其放入队列中，对请求排队或者记录请求日志，以及支持可撤销的操作。

又名**动作模式（Action）**、**事务模式（Transaction）**。

### 适用性

- 抽象出待执行的动作以参数化某对象，可使用**回调函数**表达这种参数化机制。Command 模式是回调机制的一个面向对象的替代品。
- 在不同的时刻指定、排列和执行请求。一个 Command 对象可以有一个与初始请求无关的生存期。如果一个请求的接收者可用一种与地址空间无关的方式表达，那么就可将负责该请求的命令对象传送给另一个不同的进程，并在那里实现该请求。
- 支持取消操作。
    - Command 的 Execute 操作可在实施前将状态存储起来，在取消操作时，这个状态用来消除该操作的影响。
    - Command 接口必须添加一个 Unexecute 操作，该操作取消上一次 Execute 调用的效果。
    - 执行的命令被存储在一个历史列表中，可通过“向前”和“向后”遍历这一列表并分别调用 Unexecute 和 Execute 来实现重数不限的“撤销”和“重做”。
- 支持修改日志，这样当系统崩溃时，这些修改可以被重做一遍[^1]。
    - 在Command 接口中添加**装载**和**存储**操作，可以用来保持一个一致的修改日志。
    - 从崩溃中恢复的过程包括从磁盘中重新读入记录下的命令并用 Execute 操作重新执行它们。
- 用构建在原语才坐上的高层操作构造一个系统。这样一种结构在支持**事务**（Transaction）的信息系统中很常见。
    - Command 有一个公共接口，使得你可以用同一种方式调用所有的事务。
    - 同时使用该模式也易于添加新事务以扩展系统。

[^1]: 这里很像 Redis 的 AOF 模式，保存一条条命令然后重新执行以恢复数据。



### 特点

- 将调用操作的对象与知道如何实现该操作的对象解耦。
- Command 是头等对象，他们可像其他对象一样被操纵和扩展。
- 可将多条命令装配成一个组合命令。一般来说，组合命令是 Composite 模式的一个实例。
- 增加新的 Command 很容易，因为这无需改变已有的类。



### 参与者

- Command（命令接口）
    - 声明执行操作的接口。
- ConcreteCommand（具体命令）
    - 将一个接收者对象绑定于一个动作。
    - 调用接收者相应的操作，以实现 Execute。
- Invoker（发送者/触发者）
    - 要求该命令执行这个请求。
- Receiver（接收者）
    - 知道如何实施与执行一个请求相关的操作，任何类都可能作为一个接收者。
- Client（客户端）
    - 创建一个具体命令对象，并指定它的接收者。

### 案例

- 用于对任务进行排序、 记录任务执行历史以及执行 “撤销” 操作。

### 对现有业务的思考

根据其概念和适用性，可用于各种流程的**回退/撤销**操作。这个实现需要记录每一个步骤的执行参数及顺序。

## 监听模式/观察者模式 - Observer

概念：在对象间定义一种**一对多**的依赖关系，当这个对象状态发生改变时，所有依赖它的对象都会被通知并自动更新。

**观察者模式**是对象的行为模式，又叫**发布/订阅（Publish/Subscribe）模式**、**模型/视图（Model/View）模式**、**源/监听（Source/Listener）模式**或**从属者（Dependents）模式**。其核心思想就是*在被观察者与观察者之间建立一种自动触发的关系*。

### 适用性

- 一个抽象模型有两个方面，其中一个方面依赖于另一方面。将这二者封装在独立的对象中，以使它们可以各自独立地改变或复用。
- 对一个对象的改变需要同时改变其他对象，而不知道具体有多少对象待改变。
- 一个对象必须通知其他对象，而它又不能假定其他对象是谁，换言之，你不希望这些对象是紧密耦合的。

### 案例

- MVC 的设计结构：Model 类担任目标角色即被观察者，View 则是观察者的基类。
- APP消息推送：APP是观察者，服务器数据如APP升级信息则是被观察者，一旦服务器数据有更新，就被推送到各个手机客户端。
- 状态异常邮件通知：常用登录状态是被观察者，短信和邮件的发送机制可认为是登录状态的监听者，一旦发生状态变更，就自动发送信息。

### 对现有业务的思考

观察者模式并不局限于一个更新方法，应对不同业务流程可抽象化多个接口，例如：

- 订单系统：订单作为被观察者
    - 在创建订单时，向短信系统（观察者）发送通知：创建了订单；取消订单等类同
    - 订单支付完成后，向生产系统（观察者）发送通知：收到订单，需要生产的产品信息；并向短信系统（观察者）发送通知：您的订单即将进入生产
- 生产系统：作为被观察者
    - 生产完成后，向物流系统（观察者）发送通知

## 原型模式 - Prototype

概念：用原型实例指定要创建对象的种类，并通过拷贝这些原型的属性来创建新的对象。又称为**克隆模式（clone）**。

其核心思想就是**一个`clone()`方法，用来拷贝父类的所有属性。**其中包括两个过程：

1. 分配一块新的内存空间给新的对象；
2. 拷贝父类对象的所有属性。

这个父类也就是**原型**。

> 浅拷贝：仅拷贝**引用类型对象**的指针（指向），而不拷贝引用类型对象指向的值；
>
> 深拷贝：同时拷贝引用类型对象及其指向的值。

在使用原型模式时，除非一些特殊情况（比如要求两个对象一起改变），尽量使用**深拷贝**的方式，这种也被称为“安全模式”。

### 适用性

- 当一个系统应该独立于它的产品创建、构成和表示时。
- 创建新对象的成本较高或初始化需要消耗过多资源时。
- 当要实例化的类是在运行时指定时，例如，通过动态装载。
- 为了避免创建一个与产品类层次平行的工厂类层次时。
- 当一个类的实例只能有几个不同状态组合的一种时，建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。
- 如果子类的区别仅在于其对象的初始化方式， 那么你可以使用该模式来减少子类的数量。 别人创建这些子类的目的可能是为了创建特定类型的对象。

### 特点

- 通过 clone 的方式创建对象，不会执行类的初始化函数。
- 你还可以创建一个中心化原型注册表，用于存储常用原型。
- 克隆包含循环引用的复杂对象可能会非常麻烦。

### 参与者

- Prototype（原型）
    - 声明一个克隆自身的接口。
- ConcretePrototype（具体原型）
    - 实现一个克隆自身的操作。
- Client（客户端）
    - 让一个原型克隆自身从而创建一个对象。

### 案例

- 应用程序的配置管理：应用程序在修改配置时，通常希望能备份以下原有的配置，以便能在原来的基础上进行修改，出问题时也可以切换回原来的配置。
- 文件复制：在 Windows 系统中，复制一份文件通常会在文件名后加一个 Copy + 数字。

### 对现有业务的思考

原型模式或者说克隆模式，让我想到项目里经常提到的一个需求：复制。

照例使用测试代码来简单理解：

```php
public function testExample(): void
{
    $author = new Author('Linn');
    $article = new Article('文章标题', "内容：{$author->getName()} 发表了她的第一篇文章~", $author);
    $article->addComment("恭喜");
    $article->addComment("恭喜+1");
    echo $article . "\n";

    $copyArticle = clone $article;
    $copyArticle->addComment("又有产出啦");
    echo $copyArticle . "\n";

    $copyArticle = clone $copyArticle;
    echo $copyArticle . "\n";

    $this->assertEquals(true, true);
}
```

